<html>
	<head>
		<title>chat</title>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<div id="mychat"></div>
		<input id="myinput"></input>
		<button id="mysubmit" onclick="submit();">Send</button>
		<script>
			var mychat = document.getElementById("mychat");
			var myinput = document.getElementById("myinput");
			function randselect(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
			function R10() { return randselect("1234567890"); }
			var mynick = "user" + R10() + R10() + R10() + R10();
			var myroom = "";

			var mydomain = "localhost";
			var myport = "8080";

			function submit(){
				var text = myinput.value;
				if (text.split(" ")[0] == "/nick"){
					mynick = text.split(" ")[1];
					socket.emit('identity', {nick: text.split(" ")[1]});
				} else if (text.split(" ")[0] == "/join"){
					myroom = text.split(" ")[1];
					socket.emit('join', {room: text.split(" ")[1]});
				} else {
					socket.emit('say', { text: text });
				}
				myinput.value = "";
			}

			var socket = io('http://" + mydomain + ":" + myport);
			socket.on('ready', function (data) {
				socket.emit('identity', {nick: mynick});
			});
			socket.on('say', function (data) {
				if (data.speaker)
					mychat.innerHTML += removeXSS(data.speaker) + ": " + removeXSS(data.text) + "<br/>";
				else
					mychat.innerHTML += removeXSS(data.text) + "<br/>";
			});

			function removeXSS(str){
				return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
			}
		</script>
	</body>
</html>
